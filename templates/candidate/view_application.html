{% extends "base.html" %}

{% block title %}Application Status - JobVibe AI{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="py-5" style="background: rgba(6, 182, 212, 0.1); border-bottom: 1px solid rgba(6, 182, 212, 0.2);">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
                <li class="breadcrumb-item"><a href="{{ url_for('candidate.candidate_dashboard') }}" class="text-muted">Dashboard</a></li>
                <li class="breadcrumb-item active text-white">Application Details</li>
            </ol>
        </nav>
        <h1 class="text-white fw-bold mb-1">üìÑ Application Details</h1>
        <p class="text-muted mb-0">Track your application progress</p>
    </div>
</div>

<div class="container py-5">
    <div class="row">
        <div class="col-lg-8">
            <!-- Job Info -->
            <div class="glass-card mb-4">
                <div class="p-4">
                    <div class="d-flex align-items-start">
                        <div class="d-flex align-items-center justify-content-center rounded-3 me-3" 
                             style="width: 60px; height: 60px; background: rgba(6, 182, 212, 0.15);">
                            <span style="font-size: 1.5rem;">üè¢</span>
                        </div>
                        <div class="flex-grow-1">
                            <h3 class="mb-1 fw-semibold text-white">{{ application.job.title }}</h3>
                            <h5 class="text-muted mb-2">{{ application.job.company.company_name }}</h5>
                            <div class="d-flex flex-wrap gap-2">
                                <span class="badge" style="background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.8);">
                                    üìç {{ application.job.location or 'Remote' }}
                                </span>
                                <span class="badge" style="background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.8);">
                                    {{ application.job.job_type }}
                                </span>
                            </div>
                        </div>
                        <span class="badge fs-5" style="background: {% if application.status == 'Applied' %}rgba(99, 102, 241, 0.2); color: #a5b4fc;{% elif application.status == 'Screening' %}rgba(6, 182, 212, 0.2); color: #06b6d4;{% elif application.status == 'Shortlisted' %}rgba(16, 185, 129, 0.2); color: #10b981;{% elif application.status == 'Interview' %}rgba(245, 158, 11, 0.2); color: #f59e0b;{% elif application.status == 'Rejected' %}rgba(239, 68, 68, 0.2); color: #ef4444;{% else %}rgba(16, 185, 129, 0.2); color: #10b981;{% endif %}">
                            {{ application.status }}
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- Application Timeline -->
            <div class="glass-card mb-4">
                <div class="p-4 border-bottom" style="border-color: rgba(255, 255, 255, 0.1) !important;">
                    <h5 class="mb-0 fw-semibold text-white"><span class="me-2">üïê</span>Application Timeline</h5>
                </div>
                <div class="p-4">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-marker" style="background: #10b981;"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1 fw-semibold text-white">‚úÖ Application Submitted</h6>
                                <small class="text-muted">{{ application.applied_at.strftime('%B %d, %Y at %H:%M') }}</small>
                            </div>
                        </div>
                        
                        {% if application.ai_resume_score > 0 %}
                        <div class="timeline-item">
                            <div class="timeline-marker" style="background: #10b981;"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1 fw-semibold text-white">ü§ñ AI Screening Completed</h6>
                                <small class="text-muted">Your resume has been analyzed</small>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if application.status in ['Shortlisted', 'Interview', 'Hired'] %}
                        <div class="timeline-item">
                            <div class="timeline-marker" style="background: #10b981;"></div>
                            <div class="timeline-content">
                                <h6 class="mb-1 fw-semibold text-white">‚≠ê Shortlisted</h6>
                                <small class="text-muted">Qualified for video interview</small>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if application.interview %}
                            {% if application.interview.is_completed %}
                            <div class="timeline-item">
                                <div class="timeline-marker" style="background: #10b981;"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1 fw-semibold text-white">üé• Interview Completed</h6>
                                    <small class="text-muted">{{ application.interview.completed_at.strftime('%B %d, %Y') if application.interview.completed_at else 'Completed' }}</small>
                                </div>
                            </div>
                            {% else %}
                            <div class="timeline-item">
                                <div class="timeline-marker" style="background: #f59e0b;"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1 fw-semibold text-white">‚è≥ Interview Pending</h6>
                                    <small class="text-muted">Complete your video interview</small>
                                </div>
                            </div>
                            {% endif %}
                        {% endif %}
                        
                        {% if application.interview and application.interview.result %}
                            {% if application.interview.result.hr_decision == 'Selected' %}
                            <div class="timeline-item">
                                <div class="timeline-marker" style="background: #10b981;"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1" style="color: #10b981;">Selected! üéâ</h6>
                                    <small class="text-muted">You've been selected for the next round</small>
                                </div>
                            </div>
                            {% elif application.interview.result.hr_decision == 'Rejected' %}
                            <div class="timeline-item">
                                <div class="timeline-marker bg-danger"></div>
                                <div class="timeline-content">
                                    <h6 class="mb-1 text-danger">Application Closed</h6>
                                    <small class="text-muted">Unfortunately, you were not selected for this position</small>
                                </div>
                            </div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- AI Analysis Status - Detailed scores hidden from candidates -->
            <div class="glass-card mb-4">
                <div class="p-4 border-bottom" style="border-color: rgba(255, 255, 255, 0.1) !important;">
                    <h5 class="mb-0 text-white"><i class="bi bi-robot me-2"></i>AI Resume Analysis</h5>
                </div>
                <div class="p-4">
                    <div class="text-center py-3">
                        <div class="mb-3">
                            <span style="font-size: 3rem;">ü§ñ</span>
                        </div>
                        <h5 class="mb-2" style="color: #10b981;">
                            <i class="bi bi-check-circle me-2"></i>Analysis Complete
                        </h5>
                        <p class="text-muted mb-0">
                            Your resume has been analyzed by our AI system. The hiring team will review your 
                            application based on the analysis results.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Interview Results - Scores hidden from candidates per system requirements -->
            {% if application.interview and application.interview.is_completed and application.interview.result %}
            {% set result = application.interview.result %}
            <div class="glass-card">
                <div class="p-4 border-bottom" style="border-color: rgba(255, 255, 255, 0.1) !important;">
                    <h5 class="mb-0 text-white"><i class="bi bi-check-circle me-2"></i>Interview Completed</h5>
                </div>
                <div class="p-5 text-center">
                    <div class="mb-4">
                        <span style="font-size: 4rem;">‚úÖ</span>
                    </div>
                    <h4 class="mb-3 text-white">Thank You for Completing the Interview!</h4>
                    <p class="text-muted mb-4">
                        Your interview has been submitted successfully. The hiring team is reviewing your performance 
                        and will contact you with updates soon.
                    </p>
                    
                    {% if result.hr_decision == 'Selected' %}
                    <div class="alert" style="background: rgba(16, 185, 129, 0.15); border: 1px solid rgba(16, 185, 129, 0.3); color: #10b981;">
                        <i class="bi bi-trophy me-2"></i>
                        <strong>Congratulations!</strong> You have been selected for this position.
                    </div>
                    {% elif result.hr_decision == 'Rejected' %}
                    <div class="alert" style="background: rgba(156, 163, 175, 0.1); border: 1px solid rgba(156, 163, 175, 0.2); color: rgba(255,255,255,0.7);">
                        <i class="bi bi-info-circle me-2"></i>
                        Thank you for your interest. Unfortunately, we have decided to move forward with other candidates.
                    </div>
                    {% elif result.hr_decision == 'On-Hold' %}
                    <div class="alert" style="background: rgba(6, 182, 212, 0.15); border: 1px solid rgba(6, 182, 212, 0.3); color: #06b6d4;">
                        <i class="bi bi-hourglass-split me-2"></i>
                        Your application is currently on hold. We will update you soon.
                    </div>
                    {% else %}
                    <div class="alert" style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255,255,255,0.8);">
                        <i class="bi bi-clock me-2"></i>
                        <strong>Under Review</strong> - Please wait for further updates from the company.
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Action Card -->
            {% if application.interview and not application.interview.is_completed %}
            <div class="glass-card mb-4" style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.1)); border-color: rgba(245, 158, 11, 0.3);">
                <div class="p-4 text-center">
                    <i class="bi bi-camera-video display-4" style="color: #f59e0b;"></i>
                    <h5 class="mt-3 text-white">Interview Pending</h5>
                    <p class="text-muted mb-3">Complete your video interview to continue</p>
                    <p class="mb-3 text-white"><strong>OTP Code:</strong> <code class="fs-5" style="background: rgba(245, 158, 11, 0.2); color: #f59e0b; padding: 0.25rem 0.5rem; border-radius: 0.25rem;">{{ application.interview.otp_code }}</code></p>
                    <a href="{{ url_for('interview.verify_otp') }}" class="btn btn-lg w-100" style="background: linear-gradient(135deg, #f59e0b, #d97706); border: none; color: #000;">
                        Start Interview
                    </a>
                </div>
            </div>
            {% endif %}
            
            <!-- Application Details -->
            <div class="glass-card mb-4">
                <div class="p-4 border-bottom" style="border-color: rgba(255, 255, 255, 0.1) !important;">
                    <h6 class="mb-0 text-white">Application Details</h6>
                </div>
                <div class="p-4">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2 text-muted">
                            <i class="bi bi-calendar3 me-2"></i>
                            <strong class="text-white">Applied:</strong> {{ application.applied_at.strftime('%b %d, %Y') }}
                        </li>
                        <li class="mb-2 text-muted">
                            <i class="bi bi-file-earmark-pdf me-2"></i>
                            <strong class="text-white">Resume:</strong> 
                            {% if application.resume_path and application.resume_path != 'no_resume_uploaded' %}
                            <span style="color: #10b981;">Submitted</span>
                            {% else %}
                            <span class="text-muted">Not uploaded</span>
                            {% endif %}
                        </li>
                        <li class="mb-2 text-muted">
                            <i class="bi bi-check2-circle me-2"></i>
                            <strong class="text-white">AI Review:</strong> <span style="color: #10b981;">Complete</span>
                        </li>
                        <li class="text-muted">
                            <i class="bi bi-flag me-2"></i>
                            <strong class="text-white">Status:</strong> {{ application.status }}
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Job Quick View -->
            <div class="glass-card">
                <div class="p-4 border-bottom" style="border-color: rgba(255, 255, 255, 0.1) !important;">
                    <h6 class="mb-0 text-white">Job Requirements</h6>
                </div>
                <div class="p-4">
                    <p class="small text-muted">{{ application.job.requirements[:300] }}...</p>
                    <a href="{{ url_for('main.job_detail', job_id=application.job.job_id) }}" class="btn btn-outline-primary btn-sm w-100">
                        View Full Job Details
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding-left: 30px;
}
.timeline::before {
    content: '';
    position: absolute;
    left: 10px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: rgba(255, 255, 255, 0.1);
}
.timeline-item {
    position: relative;
    padding-bottom: 20px;
}
.timeline-marker {
    position: absolute;
    left: -25px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    top: 4px;
    box-shadow: 0 0 10px currentColor;
}
</style>
{% endblock %}


